{% extends "project/base.html" %}
{% block title %}{{ recipe.title }}{% endblock %}
{% block content %}
<div class="recipe-detail-card">
    <h1 class="recipe-title">{{ recipe.title }}</h1>
    <div class="recipe-content">
        {% if recipe.image %}
        <div class="recipe-image">
            <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" style="width: 150px; height: 150px;">
        </div>
        {% endif %}
        <div class="recipe-info">
            <p><strong>Description:</strong> {{ recipe.description }}</p>
            <p><strong>Preparation Time:</strong> {{ recipe.preparation_time }} minutes</p>
            <p><strong>Meal Type:</strong> {{ recipe.meal_type }}</p>
            <p><strong>Categories:</strong> 
                {% for category in recipe.categories.all %}
                {{ category.name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
        </div>
    </div>
    <div class="recipe-instructions">
        <h3>Ingredients</h3>
        <ul>
            {% for ri in recipe.recipe_ingredients.all %}
            <li>{{ ri.quantity }} of {{ ri.ingredient.name }}</li>
            {% endfor %}
        </ul>
        <h3>Instructions</h3>
        <p>{{ recipe.instructions }}</p>
    </div>
    <a href="{% url 'recipe_list' %}" class="back-link">Back to Recipes</a>
</div>

{% if user.is_authenticated %}
<div class="comments-section">
    <h2>Comments</h2>

    <!-- Comment form -->
    <form method="post" class="comment-form">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type="submit" class="btn">Post Comment</button>
    </form>

    <!-- Display existing comments -->
    <div class="comments-list">
        {% for comment in comments %}
        <div class="comment-card">
            <p><strong>{{ comment.user.username }}</strong> - {{ comment.timestamp|date:"M d, Y H:i" }}</p>
            <p>{{ comment.content }}</p>
            {% if comment.user == user %}
                <a href="{% url 'comment_edit' comment.pk %}" class="btn small">Edit</a>
                <a href="{% url 'comment_delete' comment.pk %}" class="btn small danger">Delete</a>
            {% endif %}
        </div>
        {% empty %}
        <p>No comments yet. Be the first to comment!</p>
        {% endfor %}
    </div>
</div>
{% else %}
<p class="login-prompt">Please <a href="{% url 'project_login' %}">log in</a> to view and post comments.</p>
{% endif %}
{% endblock %}